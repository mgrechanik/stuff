# Поисковик точек на изображении

[English version](../README.md)

## Содержание

* [Введение](#goal)
* [Демо](#demo)
* [Установка](#installing)
* [Поиск путей](#search)
* [Производительность](#performance)
* [Терминология](#terminology)


---

## Цель <span id="goal"></span>

Данная библиотека позволяет на изображении (картинке ```jpg```) узнать координаты точек, которые вы ищете.

Точка это набор рядом стоящих пикселов выбранного цвета.

Для примера если вы на изображении нарисовали граф, мы узнаем его вершины.

Для определения, что является точкой, а что нет, из коробки идут две стратегии.

1. ```DifferentColorsStrategy``` - когда точка определяется тем, что отличается от цвета фона. Работает по умолчанию. См Демо. рис1.
2. ```ChoosenColorStrategy``` - когда точка определяется конкретно ее цветом.  См Демо. рис2.

Вы можете создать свою стратегию поиска и использовать ее.

Точки могут быть разного размера, чтобы были видны, а не 1px, и чтобы их нашло как одну, используется параметр ```Searcher::$margin```.

Результатом работы поисковика будет массив точек, представленных их X и Y координатами.

В поставке идет также ```ImageResult```, который позволяет создать изображение результата поиска:
- Найденным точкам можно проставить надписи
- Границы найденных точек можно обвести, чтобы понятней было как происходил поиск
- Между точками можно проложить путь из линий


---

## Демо <span id="demo"></span>

Определение точек по стратегии ```DifferentColorsStrategy``` , **Рисунок 1**:
![Определение точек на изображении](https://raw.githubusercontent.com/mgrechanik/yii2-categories-and-tags/master/docs/images/categories.png "Определение точек на изображении")


Определение точек по стратегии ```ChoosenColorStrategy``` , **Рисунок 2**:
![Определение точек на изображении](https://raw.githubusercontent.com/mgrechanik/yii2-categories-and-tags/master/docs/images/categories.png "Определение точек на изображении карты США")

	
---
    
## Установка <span id="installing"></span>

#### Установка через composer:

Выполните
```
composer require --prefer-dist mgrechanik/yii2-categories-and-tags
```

или добавьте
```
"mgrechanik/yii2-categories-and-tags" : "~1.0.0"
```
в  `require` секцию вашего `composer.json` файла.



---

## Поиск точек  <span id="search"></span> 

#### Поиск по стратегии ```DifferentColorsStrategy```
```php
try {
  $searcher = new \mgrechanik\imagepointssearcher\Searcher(
    './images/graph.jpg'
  );
  $count = $searcher->run();
  print 'Найдено - ' . $count;
  $points = $searcher->getPoints();
  var_dump($points);
} catch (Exception $e) {
	
}
```
Результат будет, например:
```
Найдено - 2
[
	['x' => 10, 'y' => 10],
	['x' => 80, 'y' => 80],
]
```

#### Поиск по стратегии ```ChoosenColorStrategy```
```php
try {
  $searcher = new \mgrechanik\imagepointssearcher\Searcher(
    './images/usa.jpg',
    new \mgrechanik\imagepointssearcher\ChoosenColorStrategy(60, 132, 253)
  );
  $count = $searcher->run();
  print 'Найдено - ' . $count;
  $points = $searcher->getPoints();
  var_dump($points);
} catch (Exception $e) {
	
}
```




---

## Производительность  <span id="performance"></span>   

> Прежде всего отключите XDebug или аналоги, т.к. они могут на порядок влиять на скорость работы

Данный ACO алгоритм находит хорошие пути на графе. И даже лучшие. Для сравнения берем библиотеку TSPLIB95, которая содержит Задачи коммивояжера - исходные данные и лучшие рузультаты, которые были когда либо найдены для этих задач (пути и расстояния).

Для примера возьму задачу ```berlin52.tsp``` из этой библиотеки, где 52 узла у графа.
Решаем задачу кодом ниже:
```php
$cities = TspLibLoader::loadCitiesFromEuc2dFile(__DIR__ . '/images/data/berlin52.tsp');
$finder = new \mgrechanik\aco\elitist\Finder();
$finder->setSigmaPercent(150);
$finder->setMPercent(30);
$finder->setAlpha(0.7);
$manager = new Manager(finder : $finder);
$manager->setCities(...$cities);
$distance = $manager->run(300);
var_dump('Distance=' . $distance);
var_dump($finder->getHistory());
```
Получим вывод:
```php
Distance=7542

   Array ... 
    [85] => Array
        (
            [distance] => 7542
            [inner_path] => 0_21_30_17_2_16_20_41_6_1_29_22_19_49_28_15_45_43_33_34_35_38_39_36_37_47_23_4_14_5_3_24_11_27_26_25_46_12_13_51_10_50_32_42_9_8_7_40_18_44_31_48_0
            [iteration] => 85
            [time_spent] => 1.94 sec
        )  
    )
```

Данный код, работая на офисном компьютере, за менее чем 2 секунды, смог найти самый лучший путь из известных.

Здесь мы использовали поисковик на основе алгоритма с использования элитных муравьев. Он на практике дает лучшие результаты, чем классический.

Алгоритм вероятностный, каждый раз муравьи будут путешествовать по другому. И очень многое зависит от настройки всех коэффициентов и параметров, участвующих в формулах.

---

## Терминология  <span id="terminology"></span>   

#### ```ACO``` - Муравьиный алгоритм (Ant colony optimization algorithm)

#### ```Nodes``` - Ноды, или узлы, или вершины графа. Или города. Муравьи путешествуют между ними

#### ```Adjacency Matrix``` - Матрица смежности, задает расстояния между узлами графа. Это базовая структура, с которой начинает работать алгоритм.
Если граф представлен как ```Города``` с координатами, то эта информация сначала переводится в матрицу смежности.

#### ```Finder``` - Поисковик, реализующий Классическую разновидность ACO алгоритма

#### ```Elitist Finder``` - Поисковик, реализующий алгоритм ACO с использованием элитных муравьев

#### ```ant``` - муравей, рабочий юнит, который двигается по графу и ищет пути

#### ```Task``` - Задача, решаемая на графе. Например это может быть ```"Задача коммивояжера"```. Или задача ```"О кратчайшем пути"```. Или другая.

#### ```Manager``` - Обьект, задача которого, сформировать Матрицу смежности, и передать ```Поисковику``` выполнение выбранной ```Задачи```.

#### ```Iteration``` - Итерация, во время которой, все муравьи находят по одному пути и откладывают феромоны. Количество итераций задаем сами

#### ```Pheromon``` - Феромон, то вещество, которое муравьи оставляют на найденных путях

#### ```m``` - Количество муравьев

#### ```mPercent``` - Количество муравьев в процентах относительно кол-ва узлов графа

#### ```sigma``` - Количество элитных муравьев, если используем соответствующий алгоритм

#### ```sigmaPercent``` - Количество элитных муравьев в процентах относительно кол-ва регулярных муравьев

#### ```alpha``` - коэффициент влияния обьема феромонов на выбор пути

#### ```beta``` - коэффициент влияния привлекательности пути

#### ```p``` - коэффициент испарения феромонов после каждой итерации

#### ```c``` - стартовое кол-во феромонов на всех путях

#### ```Q``` - Константа, участвующая в вычислении, сколько феромонов муравей оставляет на найденном пути
